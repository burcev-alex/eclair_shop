!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(e.jQuery)}(this,function(h){"use strict";function t(r,t){return function(s,e){var o,a=[];return t(e)&&(o=k.splitTokens(k.split(s,r)),p.each(e,function(e,t){var n=e.value;if(k.stringEncloses(s,n))return!1;var i=k.splitTokens(k.split(n,r));0===p.minus(o,i).length&&a.push(t)})),1===a.length?a[0]:-1}}function u(e,t){var n=/<strong>/;return n.test(t)&&!n.test(e)?t:e}function n(e){this.urlSuffix=e.toLowerCase(),this.noSuggestionsHint="Неизвестное значение",this.matchers=[J.matchByNormalizedQuery(),J.matchByWords()]}function c(e,t){var n=this;n.element=e,n.el=h(e),n.suggestions=[],n.badQueries=[],n.selectedIndex=-1,n.currentValue=n.element.value,n.intervalId=0,n.cachedResponse={},n.enrichmentCache={},n.currentRequest=null,n.inputPhase=h.Deferred(),n.fetchPhase=h.Deferred(),n.enrichPhase=h.Deferred(),n.onChangeTimeout=null,n.triggering={},n.$wrapper=null,n.options=h.extend({},F,t),n.classes=x,n.disabled=!1,n.selection=null,n.$viewport=h(window),n.$body=h(document.body),n.type=null,n.status={},n.setupElement(),n.initializer=h.Deferred(),n.el.is(":visible")?n.initializer.resolve():n.deferInitialization(),n.initializer.done(h.proxy(n.initialize,n))}function e(){$.each(te,function(e){e.abort()}),te={}}function i(e){this.plan=e.status.plan,this.isMobile=e.isMobile;var t=e.getContainer();this.element=_e.selectByClass(x.promo,t)}h=h&&h.hasOwnProperty("default")?h.default:h;var d,s,o,a,f={isArray:function(e){return Array.isArray(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return 0===Object.keys(e).length&&e.constructor===Object},isPlainObject:function(e){return!(void 0===e||"object"!=typeof e||null===e||e.nodeType||e===e.window||e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))}},p={compact:function(e){return e.filter(function(e){return!!e})},each:function(n,i){Array.isArray(n)?n.some(function(e,t){return!1===i(e,t)}):Object.keys(n).some(function(e){var t=n[e];return!1===i(t,e)})},intersect:function(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter(function(e){return-1!==t.indexOf(e)}):[]},minus:function(e,t){return t&&0!==t.length?e.filter(function(e){return-1===t.indexOf(e)}):e},makeArray:function(e){return f.isArray(e)?Array.prototype.slice.call(e):[e]},minusWithPartialMatching:function(e,n){return n&&0!==n.length?e.filter(function(t){return!n.some(function(e){return 0===e.indexOf(t)})}):e},slice:function(e,t){return Array.prototype.slice.call(e,t)}},r={delay:function(e,t){return setTimeout(e,t||0)}},l={areSame:function n(e,i){var s=!0;return typeof e==typeof i&&("object"==typeof e&&null!=e&&null!=i?(p.each(e,function(e,t){return s=n(e,i[t])}),s):e===i)},assign:function(e,t){if("function"==typeof Object.assign)return Object.assign.apply(null,arguments);if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])}return n},clone:function(e){return JSON.parse(JSON.stringify(e))},compact:function(e){var n=l.clone(e);return p.each(n,function(e,t){null!=e&&""!==e||delete n[t]}),n},fieldsAreNotEmpty:function(n,e){if(!f.isPlainObject(n))return!1;var i=!0;return p.each(e,function(e,t){return i=!!n[e]}),i},getDeepValue:function e(t,n){var i=n.split("."),s=i.shift();return t&&(i.length?e(t[s],i.join(".")):t[s])},indexObjectsById:function(e,s,o){var a={};return p.each(e,function(e,t){var n=e[s],i={};o&&(i[o]=t),a[n]=l.assign(i,e)}),a}},g=13,m=27,y=9,v=32,b=38,_=40,x={hint:"suggestions-hint",mobile:"suggestions-mobile",nowrap:"suggestions-nowrap",promo:"suggestions-promo",promo_desktop:"suggestions-promo-desktop",selected:"suggestions-selected",suggestion:"suggestions-suggestion",subtext:"suggestions-subtext",subtext_inline:"suggestions-subtext suggestions-subtext_inline",subtext_delimiter:"suggestions-subtext-delimiter",subtext_label:"suggestions-subtext suggestions-subtext_label",removeConstraint:"suggestions-remove",value:"suggestions-value"},S=".suggestions",w="\\s\"'~\\*\\.,:\\|\\[\\]\\(\\)\\{\\}<>№",C=new RegExp("["+w+"]+","g"),E=new RegExp("[\\-\\+\\\\\\?!@#$%^&]+","g"),k={escapeHtml:function(n){return n&&p.each({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},function(e,t){n=n.replace(new RegExp(t,"g"),e)}),n},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},formatToken:function(e){return e&&e.toLowerCase().replace(/[ёЁ]/g,"е")},getWordExtractorRegExp:function(){return new RegExp("([^"+w+"]*)(["+w+"]*)","g")},normalize:function(e,t){return k.split(e,t).join(" ")},padEnd:function(e,t,n){return String.prototype.padEnd?e.padEnd(t,n):(t>>=0,n=String(void 0!==n?n:" "),e.length>t?String(e):((t-=e.length)>n.length&&(n+=n.repeat(t/n.length)),String(e)+n.slice(0,t)))},split:function(e,t){var n=e.toLowerCase().replace("ё","е").replace(/(\d+)([а-я]{2,})/g,"$1 $2").replace(/([а-я]+)(\d+)/g,"$1 $2"),i=p.compact(n.split(C));if(!i.length)return[];var s=i.pop(),o=p.minus(i,t);return o.push(s),o},splitTokens:function(e){var i=[];return p.each(e,function(e,t){var n=e.split(E);i=i.concat(p.compact(n))}),i},stringEncloses:function(e,t){return e.length>t.length&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},tokenize:function(e,t){var n=p.compact(k.formatToken(e).split(C)),i=p.minus(n,t),s=p.minus(n,i);return k.withSubTokens(i.concat(s))},withSubTokens:function(e){var i=[];return p.each(e,function(e,t){var n=e.split(E);i.push(e),1<n.length&&(i=i.concat(p.compact(n)))}),i}},P=function(){return h.Deferred()},T=function(e){return h.ajax(e)},L=function(){return h.extend.apply(null,arguments)},j=function(e){return e instanceof h},V=function(e){return h.param(e)},R=function(e,t){return h.proxy(e,t)},O=function(e){return h(e)},B=function(){return h.support.cors},D={getDefaultType:function(){return B()?"POST":"GET"},getDefaultContentType:function(){return B()?"application/json":"application/x-www-form-urlencoded"},fixURLProtocol:function(e){return B()?e:e.replace(/^https?:/,location.protocol)},addUrlParams:function(e,t){return e+(/\?/.test(e)?"&":"?")+V(t)},serialize:function(e){return B()?JSON.stringify(e,function(e,t){return null===t?void 0:t}):(e=l.compact(e),V(e,!0))}},I=(a=0,function(e){return(e||"")+ ++a}),$={escapeRegExChars:k.escapeRegExChars,escapeHtml:k.escapeHtml,formatToken:k.formatToken,normalize:k.normalize,reWordExtractor:k.getWordExtractorRegExp,stringEncloses:k.stringEncloses,addUrlParams:D.addUrlParams,getDefaultContentType:D.getDefaultContentType,getDefaultType:D.getDefaultType,fixURLProtocol:D.fixURLProtocol,serialize:D.serialize,arrayMinus:p.minus,arrayMinusWithPartialMatching:p.minusWithPartialMatching,arraysIntersection:p.intersect,compact:p.compact,each:p.each,makeArray:p.makeArray,slice:p.slice,delay:r.delay,areSame:l.areSame,compactObject:l.compact,getDeepValue:l.getDeepValue,fieldsNotEmpty:l.fieldsAreNotEmpty,indexBy:l.indexObjectsById,isArray:f.isArray,isEmptyObject:f.isEmptyObject,isFunction:f.isFunction,isPlainObject:f.isPlainObject,uniqueId:I},F={autoSelectFirst:!1,serviceUrl:"https://suggestions.dadata.ru/suggestions/api/4_1/rs",url:null,onSearchStart:h.noop,onSearchComplete:h.noop,onSearchError:h.noop,onSuggestionsFetch:null,onSelect:null,onSelectNothing:null,onInvalidateSelection:null,minChars:1,deferRequestBy:100,enrichmentEnabled:!0,params:{},paramName:"query",timeout:3e3,formatResult:null,formatSelected:null,noCache:!1,containerClass:"suggestions-suggestions",tabDisabled:!1,triggerSelectOnSpace:!1,triggerSelectOnEnter:!0,triggerSelectOnBlur:!0,preventBadQueries:!1,hint:"Выберите вариант или продолжите ввод",noSuggestionsHint:null,type:null,requestMode:"suggest",count:5,$helpers:null,headers:null,scrollOnFocus:!0,mobileWidth:980,initializeInterval:100},q=(o=function(e){return e},function(e){if(0===e.length)return!1;if(1===e.length)return!0;var t=o(e[0].value);return 0===e.filter(function(e){return 0!==o(e.value).indexOf(t)}).length}),z=function(a){return function(i,e){var s=k.normalize(i,a),o=[];return p.each(e,function(e,t){var n=e.value.toLowerCase();return!k.stringEncloses(i,n)&&!(0<n.indexOf(s))&&void(s===k.normalize(n,a)&&o.push(t))}),1===o.length?o[0]:-1}},A=function(e){return t(e,q)},M=function(e){return t(e,q)},N=function(n){return function(e,s){var t=k.splitTokens(k.split(e)),o=[];return 1===s.length&&(n&&p.each(n,function(e,t){var n=l.getDeepValue(s[0],t),i=n&&k.splitTokens(k.split(n,e));i&&i.length&&(o=o.concat(i))}),0===p.minusWithPartialMatching(t,o).length)?0:-1}},U=["ао","аобл","дом","респ","а/я","аал","автодорога","аллея","арбан","аул","б-р","берег","бугор","вал","вл","волость","въезд","высел","г","городок","гск","д","двлд","днп","дор","дп","ж/д_будка","ж/д_казарм","ж/д_оп","ж/д_платф","ж/д_пост","ж/д_рзд","ж/д_ст","жилзона","жилрайон","жт","заезд","заимка","зона","к","казарма","канал","кв","кв-л","км","кольцо","комн","кордон","коса","кп","край","линия","лпх","м","массив","местность","мкр","мост","н/п","наб","нп","обл","округ","остров","оф","п","п/о","п/р","п/ст","парк","пгт","пер","переезд","пл","пл-ка","платф","погост","полустанок","починок","пр-кт","проезд","промзона","просек","просека","проселок","проток","протока","проулок","р-н","рзд","россия","рп","ряды","с","с/а","с/мо","с/о","с/п","с/с","сад","сквер","сл","снт","спуск","ст","ст-ца","стр","тер","тракт","туп","у","ул","уч-к","ф/х","ферма","х","ш","бульвар","владение","выселки","гаражно-строительный","город","деревня","домовладение","дорога","квартал","километр","комната","корпус","литер","леспромхоз","местечко","микрорайон","набережная","область","переулок","платформа","площадка","площадь","поселение","поселок","проспект","разъезд","район","республика","село","сельсовет","слобода","сооружение","станица","станция","строение","территория","тупик","улица","улус","участок","хутор","шоссе"],H=[{id:"kladr_id",fields:["kladr_id"],forBounds:!1,forLocations:!0},{id:"postal_code",fields:["postal_code"],forBounds:!1,forLocations:!0},{id:"country_iso_code",fields:["country_iso_code"],forBounds:!1,forLocations:!0},{id:"country",fields:["country"],forBounds:!0,forLocations:!0,kladrFormat:{digits:0,zeros:13},fiasType:"country_iso_code"},{id:"region_fias_id",fields:["region_fias_id"],forBounds:!1,forLocations:!0},{id:"region_type_full",fields:["region_type_full"],forBounds:!1,forLocations:!0,kladrFormat:{digits:2,zeros:11},fiasType:"region_fias_id"},{id:"region",fields:["region","region_type","region_type_full","region_with_type"],forBounds:!0,forLocations:!0,kladrFormat:{digits:2,zeros:11},fiasType:"region_fias_id"},{id:"area_fias_id",fields:["area_fias_id"],forBounds:!1,forLocations:!0},{id:"area_type_full",fields:["area_type_full"],forBounds:!1,forLocations:!0,kladrFormat:{digits:5,zeros:8},fiasType:"area_fias_id"},{id:"area",fields:["area","area_type","area_type_full","area_with_type"],forBounds:!0,forLocations:!0,kladrFormat:{digits:5,zeros:8},fiasType:"area_fias_id"},{id:"city_fias_id",fields:["city_fias_id"],forBounds:!1,forLocations:!0},{id:"city_type_full",fields:["city_type_full"],forBounds:!1,forLocations:!0,kladrFormat:{digits:8,zeros:5},fiasType:"city_fias_id"},{id:"city",fields:["city","city_type","city_type_full","city_with_type"],forBounds:!0,forLocations:!0,kladrFormat:{digits:8,zeros:5},fiasType:"city_fias_id"},{id:"city_district_fias_id",fields:["city_district_fias_id"],forBounds:!1,forLocations:!0},{id:"city_district_type_full",fields:["city_district_type_full"],forBounds:!1,forLocations:!0,kladrFormat:{digits:11,zeros:2},fiasType:"city_district_fias_id"},{id:"city_district",fields:["city_district","city_district_type","city_district_type_full","city_district_with_type"],forBounds:!0,forLocations:!0,kladrFormat:{digits:11,zeros:2},fiasType:"city_district_fias_id"},{id:"settlement_fias_id",fields:["settlement_fias_id"],forBounds:!1,forLocations:!0},{id:"settlement_type_full",fields:["settlement_type_full"],forBounds:!1,forLocations:!0,kladrFormat:{digits:11,zeros:2},fiasType:"settlement_fias_id"},{id:"settlement",fields:["settlement","settlement_type","settlement_type_full","settlement_with_type"],forBounds:!0,forLocations:!0,kladrFormat:{digits:11,zeros:2},fiasType:"settlement_fias_id"},{id:"street_fias_id",fields:["street_fias_id"],forBounds:!1,forLocations:!0},{id:"street_type_full",fields:["street_type_full"],forBounds:!1,forLocations:!0,kladrFormat:{digits:15,zeros:2},fiasType:"street_fias_id"},{id:"street",fields:["street","street_type","street_type_full","street_with_type"],forBounds:!0,forLocations:!0,kladrFormat:{digits:15,zeros:2},fiasType:"street_fias_id"},{id:"house",fields:["house","house_type","house_type_full","block","block_type"],forBounds:!0,forLocations:!1,kladrFormat:{digits:19}}],W={urlSuffix:"address",noSuggestionsHint:"Неизвестный адрес",matchers:[z(U),M(U)],dataComponents:H,dataComponentsById:l.indexObjectsById(H,"id","index"),unformattableTokens:U,enrichmentEnabled:!0,enrichmentMethod:"suggest",enrichmentParams:{count:1,locations:null,locations_boost:null,from_bound:null,to_bound:null},getEnrichmentQuery:function(e){return e.unrestricted_value},geoEnabled:!0,isDataComplete:function(e){var t=[this.bounds.to||"flat"],n=e.data;return!f.isPlainObject(n)||l.fieldsAreNotEmpty(n,t)},composeValue:function(e,t){var n=e.country,i=e.region_with_type||p.compact([e.region,e.region_type]).join(" ")||e.region_type_full,s=e.area_with_type||p.compact([e.area_type,e.area]).join(" ")||e.area_type_full,o=e.city_with_type||p.compact([e.city_type,e.city]).join(" ")||e.city_type_full,a=e.settlement_with_type||p.compact([e.settlement_type,e.settlement]).join(" ")||e.settlement_type_full,r=e.city_district_with_type||p.compact([e.city_district_type,e.city_district]).join(" ")||e.city_district_type_full,u=e.street_with_type||p.compact([e.street_type,e.street]).join(" ")||e.street_type_full,l=p.compact([e.house_type,e.house,e.block_type,e.block]).join(" "),c=p.compact([e.flat_type,e.flat]).join(" "),d=e.postal_box&&"а/я "+e.postal_box;return i===o&&(i=""),t&&t.saveCityDistrict||(t&&t.excludeCityDistrict?r="":r&&!e.city_district_fias_id&&(r="")),p.compact([n,i,s,o,r,a,u,l,c,d]).join(", ")},formatResult:(d=[],s=!1,H.forEach(function(e){s&&d.push(e.id),"city_district"===e.id&&(s=!0)}),function(e,t,n,i){var s,o,a,r=this,u=n.data&&n.data.city_district_with_type,l=i&&i.unformattableTokens,c=n.data&&n.data.history_values;return c&&0<c.length&&(s=k.tokenize(t,l),o=this.type.findUnusedTokens(s,e),(a=this.type.getFormattedHistoryValues(o,c))&&(e+=a)),e=r.highlightMatches(e,t,n,i),e=r.wrapFormattedValue(e,n),u&&(!r.bounds.own.length||0<=r.bounds.own.indexOf("street"))&&!f.isEmptyObject(r.copyDataComponents(n.data,d))&&(e+='<div class="'+r.classes.subtext+'">'+r.highlightMatches(u,t,n)+"</div>"),e}),findUnusedTokens:function(e,t){return e.filter(function(e){return-1===t.indexOf(e)})},getFormattedHistoryValues:function(e,t){var n=[],i="";return t.forEach(function(t){p.each(e,function(e){if(0<=t.toLowerCase().indexOf(e))return n.push(t),!1})}),0<n.length&&(i=" (бывш. "+n.join(", ")+")"),i},getSuggestionValue:function(e,t){var n=null;return t.hasSameValues?n=e.options.restrict_value?this.getValueWithinConstraints(e,t.suggestion):e.bounds.own.length?this.getValueWithinBounds(e,t.suggestion):t.suggestion.unrestricted_value:t.hasBeenEnriched&&e.options.restrict_value&&(n=this.getValueWithinConstraints(e,t.suggestion,{excludeCityDistrict:!0})),n},getValueWithinConstraints:function(e,t,n){return this.composeValue(e.getUnrestrictedData(t.data),n)},getValueWithinBounds:function(e,t,n){var i=e.copyDataComponents(t.data,e.bounds.own.concat(["city_district_fias_id"]));return this.composeValue(i,n)}},Q={urlSuffix:"fio",noSuggestionsHint:!1,matchers:[z(),A()],fieldNames:{surname:"фамилия",name:"имя",patronymic:"отчество"},isDataComplete:function(e){var t,n=this.options.params,i=e.data;return f.isFunction(n)&&(n=n.call(this.element,e.value)),n&&n.parts?t=n.parts.map(function(e){return e.toLowerCase()}):(t=["surname","name"],function(e,t){var n=e.data&&e.data[t];return n&&new RegExp("^"+k.escapeRegExChars(n)+"(["+w+"]|$)","i").test(e.value)}(e,"surname")&&t.push("patronymic")),l.fieldsAreNotEmpty(i,t)},composeValue:function(e){return p.compact([e.surname,e.name,e.patronymic]).join(" ")}},K={LEGAL:[2,2,5,1],INDIVIDUAL:[2,2,6,2]},G={NAME:Q,ADDRESS:W,PARTY:{urlSuffix:"party",noSuggestionsHint:"Неизвестная организация",matchers:[N({value:null,"data.address.value":U,"data.inn":null,"data.ogrn":null})],dataComponents:H,enrichmentEnabled:!0,enrichmentMethod:"findById",enrichmentParams:{count:1,locations_boost:null},getEnrichmentQuery:function(e){return e.data.hid},geoEnabled:!0,formatResult:function(e,t,n,i){var s=this,o=u(s.type.formatResultInn.call(s,n,t),s.highlightMatches(l.getDeepValue(n.data,"ogrn"),t,n)),a=s.highlightMatches(l.getDeepValue(n.data,"management.name"),t,n),r=l.getDeepValue(n.data,"address.value")||"";return s.isMobile&&((i=i||{}).maxLength=50),e=function(e,t,n,i,s){return u(this.highlightMatches(e,n,i,s),this.highlightMatches(t,n,i,s))}.call(s,e,l.getDeepValue(n.data,"name.latin"),t,n,i),e=s.wrapFormattedValue(e,n),r&&(r=r.replace(/^(\d{6}?\s+|Россия,\s+)/i,""),r=s.isMobile?r.replace(new RegExp("^([^"+w+"]+["+w+"]+[^"+w+"]+).*"),"$1"):s.highlightMatches(r,t,n,{unformattableTokens:U})),(o||r||a)&&(e+='<div class="'+s.classes.subtext+'"><span class="'+s.classes.subtext_inline+'">'+(o||"")+"</span>"+(u(r,a)||"")+"</div>"),e},formatResultInn:function(e,t){var i,n=e.data&&e.data.inn,s=K[e.data&&e.data.type],o=/\d/;if(n)return i=this.highlightMatches(n,t,e),s&&(i=i.split(""),i=s.map(function(e){for(var t,n="";e&&(t=i.shift());)n+=t,o.test(t)&&e--;return n}).join('<span class="'+this.classes.subtext_delimiter+'"></span>')+i.join("")),i}},EMAIL:{urlSuffix:"email",noSuggestionsHint:!1,matchers:[z()],isQueryRequestable:function(e){return this.options.suggest_local||0<=e.indexOf("@")}},BANK:{urlSuffix:"bank",noSuggestionsHint:"Неизвестный банк",matchers:[N({value:null,"data.bic":null,"data.swift":null})],dataComponents:H,geoEnabled:!0,formatResult:function(e,t,n,i){var s=this,o=s.highlightMatches(l.getDeepValue(n.data,"bic"),t,n),a=l.getDeepValue(n.data,"address.value")||"";return e=s.highlightMatches(e,t,n,i),e=s.wrapFormattedValue(e,n),a&&(a=a.replace(/^\d{6}( РОССИЯ)?, /i,""),a=s.isMobile?a.replace(new RegExp("^([^"+w+"]+["+w+"]+[^"+w+"]+).*"),"$1"):s.highlightMatches(a,t,n,{unformattableTokens:U})),(o||a)&&(e+='<div class="'+s.classes.subtext+'"><span class="'+s.classes.subtext_inline+'">'+o+"</span>"+a+"</div>"),e},formatSelected:function(e){return l.getDeepValue(e,"data.name.payment")||null}}};G.get=function(e){return G.hasOwnProperty(e)?G[e]:new n(e)},L(F,{suggest_local:!0});var X={chains:{},on:function(e,t){return this.get(e).push(t),this},get:function(e){var t=this.chains;return t[e]||(t[e]=[])}},Y={suggest:{defaultParams:{type:$.getDefaultType(),dataType:"json",contentType:$.getDefaultContentType()},addTypeInUrl:!0},"iplocate/address":{defaultParams:{type:"GET",dataType:"json"},addTypeInUrl:!1},status:{defaultParams:{type:"GET",dataType:"json"},addTypeInUrl:!0},findById:{defaultParams:{type:$.getDefaultType(),dataType:"json",contentType:$.getDefaultContentType()},addTypeInUrl:!0}},Z={suggest:{method:"suggest",userSelect:!0,updateValue:!0,enrichmentEnabled:!0},findById:{method:"findById",userSelect:!1,updateValue:!1,enrichmentEnabled:!1}};c.prototype={initialize:function(){var e=this;e.uniqueId=$.uniqueId("i"),e.createWrapper(),e.notify("initialize"),e.setOptions(),e.fixPosition()},deferInitialization:function(){function e(){n.initializer.resolve(),n.enable()}var t,n=this,i="mouseover focus keydown";n.initializer.always(function(){n.el.off(i,e),clearInterval(t)}),n.disabled=!0,n.el.on(i,e),t=setInterval(function(){n.el.is(":visible")&&e()},n.options.initializeInterval)},isInitialized:function(){return"resolved"===this.initializer.state()},dispose:function(){var e=this;e.initializer.reject(),e.notify("dispose"),e.el.removeData("suggestions").removeClass("suggestions-input"),e.removeWrapper(),e.el.trigger("suggestions-dispose")},notify:function(e){var t=this,n=$.slice(arguments,1);return h.map(X.get(e),function(e){return e.apply(t,n)})},createWrapper:function(){var e=this;e.$wrapper=h('<div class="suggestions-wrapper"/>'),e.el.after(e.$wrapper),e.$wrapper.on("mousedown"+S,h.proxy(e.onMousedown,e))},removeWrapper:function(){this.$wrapper&&this.$wrapper.remove(),h(this.options.$helpers).off(S)},onMousedown:function(e){var n=this;e.preventDefault(),n.cancelBlur=!0,$.delay(function(){delete n.cancelBlur}),0==h(e.target).closest(".ui-menu-item").length&&$.delay(function(){h(document).one("mousedown",function(e){var t=n.el.add(n.$wrapper).add(n.options.$helpers);n.options.floating&&(t=t.add(n.$container)),(t=t.filter(function(){return this===e.target||h.contains(this,e.target)})).length||n.hide()})})},scrollToTop:function(){var e=this.options.scrollOnFocus;!0===e&&(e=this.el),e instanceof h&&0<e.length&&h("body,html").animate({scrollTop:e.offset().top},"fast")},setOptions:function(e){var n=this;h.extend(n.options,e),n.type=G.get(n.options.type),h.each({requestMode:Z},function(e,t){if(n[e]=t[n.options[e]],!n[e])throw n.disable(),"`"+e+"` option is incorrect! Must be one of: "+h.map(t,function(e,t){return'"'+t+'"'}).join(", ")}),h(n.options.$helpers).off(S).on("mousedown"+S,h.proxy(n.onMousedown,n)),n.isInitialized()&&n.notify("setOptions")},fixPosition:function(e){var t,n,i=this,s={};i.isMobile=i.$viewport.width()<=i.options.mobileWidth,i.isInitialized()&&(!e||"scroll"!=e.type||i.options.floating||i.isMobile)&&(i.$container.appendTo(i.options.floating?i.$body:i.$wrapper),i.notify("resetPosition"),i.el.css("paddingLeft",""),i.el.css("paddingRight",""),s.paddingLeft=parseFloat(i.el.css("paddingLeft")),s.paddingRight=parseFloat(i.el.css("paddingRight")),h.extend(s,i.el.offset()),s.borderTop="none"==i.el.css("border-top-style")?0:parseFloat(i.el.css("border-top-width")),s.borderLeft="none"==i.el.css("border-left-style")?0:parseFloat(i.el.css("border-left-width")),s.innerHeight=i.el.innerHeight(),s.innerWidth=i.el.innerWidth(),s.outerHeight=i.el.outerHeight(),s.componentsLeft=0,s.componentsRight=0,t=i.$wrapper.offset(),n={top:s.top-t.top,left:s.left-t.left},i.notify("fixPosition",n,s),s.componentsLeft>s.paddingLeft&&i.el.css("paddingLeft",s.componentsLeft+"px"),s.componentsRight>s.paddingRight&&i.el.css("paddingRight",s.componentsRight+"px"))},clearCache:function(){this.cachedResponse={},this.enrichmentCache={},this.badQueries=[]},clear:function(){var e=this,t=e.selection;e.isInitialized()&&(e.clearCache(),e.currentValue="",e.selection=null,e.hide(),e.suggestions=[],e.el.val(""),e.el.trigger("suggestions-clear"),e.notify("clear"),e.trigger("InvalidateSelection",t))},disable:function(){this.disabled=!0,this.abortRequest(),this.visible&&this.hide()},enable:function(){this.disabled=!1},isUnavailable:function(){return this.disabled},update:function(){var e=this,t=e.el.val();e.isInitialized()&&(e.currentValue=t,e.isQueryRequestable(t)?e.updateSuggestions(t):e.hide())},setSuggestion:function(e){var t,n,i=this;h.isPlainObject(e)&&h.isPlainObject(e.data)&&(e=h.extend(!0,{},e),i.isUnavailable()&&i.initializer&&"pending"===i.initializer.state()&&(i.initializer.resolve(),i.enable()),i.bounds.own.length&&(i.checkValueBounds(e),t=i.copyDataComponents(e.data,i.bounds.all),e.data.kladr_id&&(t.kladr_id=i.getBoundedKladrId(e.data.kladr_id,i.bounds.all)),e.data=t),i.selection=e,i.suggestions=[e],n=i.getSuggestionValue(e)||"",i.currentValue=n,i.el.val(n),i.abortRequest(),i.el.trigger("suggestions-set"))},fixData:function(){var t=this,e=t.extendedCurrentValue(),n=t.el.val(),i=h.Deferred();i.done(function(e){t.selectSuggestion(e,0,n,{hasBeenEnriched:!0}),t.el.trigger("suggestions-fixdata",e)}).fail(function(){t.selection=null,t.el.trigger("suggestions-fixdata")}),t.isQueryRequestable(e)?(t.currentValue=e,t.getSuggestions(e,{count:1,from_bound:null,to_bound:null}).done(function(e){var t=e[0];t?i.resolve(t):i.reject()}).fail(function(){i.reject()})):i.reject()},extendedCurrentValue:function(){var e=this.getParentInstance(),t=e&&e.extendedCurrentValue(),n=h.trim(this.el.val());return $.compact([t,n]).join(" ")},getAjaxParams:function(e,t){var n=this,i=h.trim(n.options.token),s=h.trim(n.options.partner),o=n.options.serviceUrl,a=n.options.url,r=Y[e],u=h.extend({timeout:n.options.timeout},r.defaultParams),l={};return a?o=a:(/\/$/.test(o)||(o+="/"),o+=e,r.addTypeInUrl&&(o+="/"+n.type.urlSuffix)),o=$.fixURLProtocol(o),h.support.cors?(i&&(l.Authorization="Token "+i),s&&(l["X-Partner"]=s),l["X-Version"]=c.version,u.headers||(u.headers={}),u.xhrFields||(u.xhrFields={}),h.extend(u.headers,n.options.headers,l),u.xhrFields.withCredentials=!1):(i&&(l.token=i),s&&(l.partner=s),l.version=c.version,o=$.addUrlParams(o,l)),u.url=o,h.extend(u,t)},isQueryRequestable:function(e){var t;return(t=e.length>=this.options.minChars)&&this.type.isQueryRequestable&&(t=this.type.isQueryRequestable.call(this,e)),t},constructRequestParams:function(e,t){var n=this,i=n.options,s=h.isFunction(i.params)?i.params.call(n.element,e):h.extend({},i.params);return n.type.constructRequestParams&&h.extend(s,n.type.constructRequestParams.call(n)),h.each(n.notify("requestParams"),function(e,t){h.extend(s,t)}),s[i.paramName]=e,h.isNumeric(i.count)&&0<i.count&&(s.count=i.count),h.extend(s,t)},updateSuggestions:function(t){var n=this;n.fetchPhase=n.getSuggestions(t).done(function(e){n.assignSuggestions(e,t)})},getSuggestions:function(i,e,t){var n,s=this,o=s.options,a=t&&t.noCallbacks,r=t&&t.useEnrichmentCache,u=t&&t.method||s.requestMode.method,l=s.constructRequestParams(i,e),c=h.param(l||{}),d=h.Deferred();return(n=s.cachedResponse[c])&&h.isArray(n.suggestions)?d.resolve(n.suggestions):s.isBadQuery(i)?d.reject():a||!1!==o.onSearchStart.call(s.element,l)?s.doGetSuggestions(l,u).done(function(e){s.processResponse(e)&&i==s.currentValue?(o.noCache||(r?s.enrichmentCache[i]=e.suggestions[0]:(s.enrichResponse(e,i),s.cachedResponse[c]=e,o.preventBadQueries&&0===e.suggestions.length&&s.badQueries.push(i))),d.resolve(e.suggestions)):d.reject(),a||o.onSearchComplete.call(s.element,i,e.suggestions)}).fail(function(e,t,n){d.reject(),a||"abort"===t||o.onSearchError.call(s.element,i,e,t,n)}):d.reject(),d},doGetSuggestions:function(e,t){var n=this,i=h.ajax(n.getAjaxParams(t,{data:$.serialize(e)}));return n.abortRequest(),n.currentRequest=i,n.notify("request"),i.always(function(){n.currentRequest=null,n.notify("request")}),i},isBadQuery:function(n){if(!this.options.preventBadQueries)return!1;var i=!1;return h.each(this.badQueries,function(e,t){return!(i=0===n.indexOf(t))}),i},abortRequest:function(){this.currentRequest&&this.currentRequest.abort()},processResponse:function(e){var t,n=this;return!(!e||!h.isArray(e.suggestions)||(n.verifySuggestionsFormat(e.suggestions),n.setUnrestrictedValues(e.suggestions),h.isFunction(n.options.onSuggestionsFetch)&&(t=n.options.onSuggestionsFetch.call(n.element,e.suggestions),h.isArray(t)&&(e.suggestions=t)),0))},verifySuggestionsFormat:function(n){"string"==typeof n[0]&&h.each(n,function(e,t){n[e]={value:t,data:null}})},getSuggestionValue:function(e,t){var n,i=this,s=i.options.formatSelected||i.type.formatSelected,o=t&&t.hasSameValues,a=t&&t.hasBeenEnriched,r=null;return h.isFunction(s)&&(n=s.call(i,e)),"string"!=typeof n&&(n=e.value,i.type.getSuggestionValue&&null!==(r=i.type.getSuggestionValue(i,{suggestion:e,hasSameValues:o,hasBeenEnriched:a}))&&(n=r)),n},hasSameValues:function(n){var i=!1;return h.each(this.suggestions,function(e,t){if(t.value===n.value&&t!==n)return!(i=!0)}),i},assignSuggestions:function(e,t){this.suggestions=e,this.notify("assignSuggestions",t)},shouldRestrictValues:function(){return this.options.restrict_value&&this.constraints&&1==Object.keys(this.constraints).length},setUnrestrictedValues:function(e){var n=this.shouldRestrictValues(),i=this.getFirstConstraintLabel();h.each(e,function(e,t){t.unrestricted_value||(t.unrestricted_value=n?i+", "+t.value:t.value)})},areSuggestionsSame:function(e,t){return e&&t&&e.value===t.value&&$.areSame(e.data,t.data)},getNoSuggestionsHint:function(){return!1!==this.options.noSuggestionsHint&&(this.options.noSuggestionsHint||this.type.noSuggestionsHint)}};var ee={setupElement:function(){this.el.attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false").addClass("suggestions-input").css("box-sizing","border-box")},bindElementEvents:function(){var e=this;e.el.on("keydown"+S,h.proxy(e.onElementKeyDown,e)),e.el.on(["keyup"+S,"cut"+S,"paste"+S,"input"+S].join(" "),h.proxy(e.onElementKeyUp,e)),e.el.on("blur"+S,h.proxy(e.onElementBlur,e)),e.el.on("focus"+S,h.proxy(e.onElementFocus,e))},unbindElementEvents:function(){this.el.off(S)},onElementBlur:function(){var e=this;e.cancelBlur?e.cancelBlur=!1:(e.options.triggerSelectOnBlur?e.isUnavailable()||e.selectCurrentValue({noSpace:!0}).always(function(){e.hide()}):e.hide(),e.fetchPhase.abort&&e.fetchPhase.abort())},onElementFocus:function(){this.cancelFocus||$.delay(h.proxy(this.completeOnFocus,this)),this.cancelFocus=!1},onElementKeyDown:function(e){var t=this;if(!t.isUnavailable())if(t.visible){switch(e.which){case m:t.el.val(t.currentValue),t.hide(),t.abortRequest();break;case y:if(!1===t.options.tabDisabled)return;break;case g:t.options.triggerSelectOnEnter&&t.selectCurrentValue();break;case v:return void(t.options.triggerSelectOnSpace&&t.isCursorAtEnd()&&(e.preventDefault(),t.selectCurrentValue({continueSelecting:!0,dontEnrich:!0}).fail(function(){t.currentValue+=" ",t.el.val(t.currentValue),t.proceedChangedValue()})));case b:t.moveUp();break;case _:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}else switch(e.which){case _:t.suggest();break;case g:t.options.triggerSelectOnEnter&&t.triggerOnSelectNothing()}},onElementKeyUp:function(e){var t=this;if(!t.isUnavailable()){switch(e.which){case b:case _:case g:return}clearTimeout(t.onChangeTimeout),t.inputPhase.reject(),t.currentValue!==t.el.val()&&t.proceedChangedValue()}},proceedChangedValue:function(){var e=this;e.abortRequest(),e.inputPhase=h.Deferred().done(h.proxy(e.onValueChange,e)),0<e.options.deferRequestBy?e.onChangeTimeout=$.delay(function(){e.inputPhase.resolve()},e.options.deferRequestBy):e.inputPhase.resolve()},onValueChange:function(){var e,t=this;t.selection&&(e=t.selection,t.selection=null,t.trigger("InvalidateSelection",e)),t.selectedIndex=-1,t.update(),t.notify("valueChange")},completeOnFocus:function(){var e=this;e.isUnavailable()||e.isElementFocused()&&(e.fixPosition(),e.update(),e.isMobile&&(e.setCursorAtEnd(),e.scrollToTop()))},isElementFocused:function(){return document.activeElement===this.element},isElementDisabled:function(){return Boolean(this.element.getAttribute("disabled")||this.element.getAttribute("readonly"))},isCursorAtEnd:function(){var e,t,n=this.el.val().length;try{if("number"==typeof(e=this.element.selectionStart))return e===n}catch(e){}return!document.selection||((t=document.selection.createRange()).moveStart("character",-n),n===t.text.length)},setCursorAtEnd:function(){var t=this.element;try{t.selectionEnd=t.selectionStart=t.value.length,t.scrollLeft=t.scrollWidth}catch(e){t.value=t.value}}};h.extend(c.prototype,ee),X.on("initialize",ee.bindElementEvents).on("dispose",ee.unbindElementEvents);var te={};e();var ne={checkStatus:function(){function s(e){$.isFunction(o.options.onSearchError)&&o.options.onSearchError.call(o.element,null,n,"error",e)}var o=this,e=o.options.token&&o.options.token.trim()||"",t=o.options.type+e,n=te[t];(n=n||(te[t]=T(o.getAjaxParams("status")))).done(function(e,t,n){if(e.search){var i=n.getResponseHeader("X-Plan");e.plan=i,L(o.status,e)}else s("Service Unavailable")}).fail(function(){s(n.statusText)})}};c.resetTokens=e,L(c.prototype,ne),X.on("setOptions",ne.checkStatus);var ie,se={checkLocation:function(){var n=this,e=n.options.geoLocation;n.type.geoEnabled&&e&&(n.geoLocation=h.Deferred(),h.isPlainObject(e)||h.isArray(e)?n.geoLocation.resolve(e):(ie=ie||h.ajax(n.getAjaxParams("iplocate/address"))).done(function(e){var t=e&&e.location&&e.location.data;t&&t.kladr_id?n.geoLocation.resolve({kladr_id:t.kladr_id}):n.geoLocation.reject()}).fail(function(){n.geoLocation.reject()}))},getGeoLocation:function(){return this.geoLocation},constructParams:function(){var t={};return this.geoLocation&&h.isFunction(this.geoLocation.promise)&&"resolved"==this.geoLocation.state()&&this.geoLocation.done(function(e){t.locations_boost=h.makeArray(e)}),t}};"GET"!=$.getDefaultType()&&(h.extend(F,{geoLocation:!0}),h.extend(c,{resetLocation:function(){ie=null,F.geoLocation=!0}}),h.extend(c.prototype,{getGeoLocation:se.getGeoLocation}),X.on("setOptions",se.checkLocation).on("requestParams",se.constructParams));var oe={enrichSuggestion:function(n,e){var t=this,i=h.Deferred();if(!t.options.enrichmentEnabled||!t.type.enrichmentEnabled||!t.requestMode.enrichmentEnabled||e&&e.dontEnrich)return i.resolve(n);if(n.data&&null!=n.data.qc)return i.resolve(n);t.disableDropdown();var s=t.type.getEnrichmentQuery(n),o=t.type.enrichmentParams,a={noCallbacks:!0,useEnrichmentCache:!0,method:t.type.enrichmentMethod};return t.currentValue=s,t.enrichPhase=t.getSuggestions(s,o,a).always(function(){t.enableDropdown()}).done(function(e){var t=e&&e[0];i.resolve(t||n,!!t)}).fail(function(){i.resolve(n)}),i},enrichResponse:function(n,i){var s=this.enrichmentCache[i];s&&h.each(n.suggestions,function(e,t){if(t.value===i)return n.suggestions[e]=s,!1})}};h.extend(c.prototype,oe);var ae={createContainer:function(){var e=this,t="."+e.classes.suggestion,n=e.options,i=h("<div/>").addClass(n.containerClass).css({position:"absolute",display:"none"});(e.$container=i).on("click"+S,t,h.proxy(e.onSuggestionClick,e))},getContainer:function(){return this.$container.get(0)},removeContainer:function(){this.options.floating&&this.$container.remove()},setContainerOptions:function(){var e=this;e.$container.off("mousedown.suggestions"),e.options.floating&&e.$container.on("mousedown.suggestions",h.proxy(e.onMousedown,e))},onSuggestionClick:function(e){var t,n=this,i=h(e.target);if(!n.dropdownDisabled){for(n.cancelFocus=!0,n.el.focus();i.length&&!(t=i.attr("data-index"));)i=i.closest("."+n.classes.suggestion);t&&!isNaN(t)&&n.select(+t)}},setDropdownPosition:function(e,t){var n,i=this,s=i.$viewport.scrollLeft();i.isMobile?(n=i.options.floating?{left:s+"px",top:t.top+t.outerHeight+"px"}:{left:e.left-t.left+s+"px",top:e.top+t.outerHeight+"px"}).width=i.$viewport.width()+"px":(n=i.options.floating?{left:t.left+"px",top:t.top+t.borderTop+t.innerHeight+"px"}:{left:e.left+"px",top:e.top+t.borderTop+t.innerHeight+"px"},$.delay(function(){var e=i.options.width;"auto"===e&&(e=i.el.outerWidth()),i.$container.outerWidth(e)})),i.$container.toggleClass(i.classes.mobile,i.isMobile).css(n),i.containerItemsPadding=t.left+t.borderLeft+t.paddingLeft-s},setItemsPositions:function(){this.getSuggestionsItems().css("paddingLeft",this.isMobile?this.containerItemsPadding+"px":"")},getSuggestionsItems:function(){return this.$container.children("."+this.classes.suggestion)},toggleDropdownEnabling:function(e){this.dropdownDisabled=!e,this.$container.attr("disabled",!e)},disableDropdown:function(){this.toggleDropdownEnabling(!1)},enableDropdown:function(){this.toggleDropdownEnabling(!0)},hasSuggestionsToChoose:function(){var e=this;return 1<e.suggestions.length||1===e.suggestions.length&&(!e.selection||h.trim(e.suggestions[0].value)!==h.trim(e.selection.value))},suggest:function(){var n=this,e=n.options,i=[];if(n.requestMode.userSelect){if(n.hasSuggestionsToChoose())!n.isMobile&&e.hint&&n.suggestions.length&&i.push('<div class="'+n.classes.hint+'">'+e.hint+"</div>"),n.selectedIndex=-1,n.suggestions.forEach(function(e,t){e==n.selection&&(n.selectedIndex=t),n.buildSuggestionHtml(e,t,i)});else{if(n.suggestions.length)return void n.hide();var t=n.getNoSuggestionsHint();if(!t)return void n.hide();i.push('<div class="'+n.classes.hint+'">'+t+"</div>")}i.push('<div class="'+x.promo+'"></div>'),i.push("</div>"),n.$container.html(i.join("")),e.autoSelectFirst&&-1===n.selectedIndex&&(n.selectedIndex=0),-1!==n.selectedIndex&&n.getSuggestionsItems().eq(n.selectedIndex).addClass(n.classes.selected),h.isFunction(e.beforeRender)&&e.beforeRender.call(n.element,n.$container),n.$container.show(),n.visible=!0,n.fixPosition(),n.setItemsPositions()}},buildSuggestionHtml:function(e,t,n){n.push('<div class="'+this.classes.suggestion+'" data-index="'+t+'">');var i=this.options.formatResult||this.type.formatResult||this.formatResult;n.push(i.call(this,e.value,this.currentValue,e,{unformattableTokens:this.type.unformattableTokens}));var s=this.makeSuggestionLabel(this.suggestions,e);s&&n.push('<span class="'+this.classes.subtext_label+'">'+$.escapeHtml(s)+"</span>"),n.push("</div>")},wrapFormattedValue:function(e,t){var n=$.getDeepValue(t.data,"state.status");return'<span class="'+this.classes.value+'"'+(n?' data-suggestion-status="'+n+'"':"")+">"+e+"</span>"},formatResult:function(e,t,n,i){return e=this.highlightMatches(e,t,n,i),this.wrapFormattedValue(e,n)},highlightMatches:function(e,t,n,i){var s,o,a,r,u,l,c=[],d=i&&i.unformattableTokens,f=i&&i.maxLength,p=$.reWordExtractor();if(!e)return"";for(s=k.tokenize(t,d),o=h.map(s,function(e){return new RegExp("^((.*)([\\-\\+\\\\\\?!@#$%^&]+))?("+$.escapeRegExChars(e)+")([^\\-\\+\\\\\\?!@#$%^&]*[\\-\\+\\\\\\?!@#$%^&]*)","i")});(a=p.exec(e))&&a[0];)r=a[1],c.push({text:r,hasUpperCase:r.toLowerCase()!==r,formatted:$.formatToken(r),matchable:!0}),a[2]&&c.push({text:a[2]});for(u=0;u<c.length;u++)!(l=c[u]).matchable||l.matched||-1!==h.inArray(l.formatted,d)&&!l.hasUpperCase||h.each(o,function(e,t){var n,i=t.exec(l.formatted),s=u+1;if(i)return(i={before:i[1]||"",beforeText:i[2]||"",beforeDelimiter:i[3]||"",text:i[4]||"",after:i[5]||""}).before&&(c.splice(u,0,{text:l.text.substr(0,i.beforeText.length),formatted:i.beforeText,matchable:!0},{text:i.beforeDelimiter}),s+=2,n=i.before.length,l.text=l.text.substr(n),l.formatted=l.formatted.substr(n),u--),n=i.text.length+i.after.length,l.formatted.length>n&&(c.splice(s,0,{text:l.text.substr(n),formatted:l.formatted.substr(n),matchable:!0}),l.text=l.text.substr(0,n),l.formatted=l.formatted.substr(0,n)),i.after&&(n=i.text.length,c.splice(s,0,{text:l.text.substr(n),formatted:l.formatted.substr(n)}),l.text=l.text.substr(0,n),l.formatted=l.formatted.substr(0,n)),!(l.matched=!0)});if(f){for(u=0;u<c.length&&0<=f;u++)(f-=(l=c[u]).text.length)<0&&(l.text=l.text.substr(0,l.text.length+f)+"...");c.length=u}return function(e,t){var n=e.split(", ");return 1===n.length?e:h.map(n,function(e){return'<span class="'+t+'">'+e+"</span>"}).join(", ")}(function(e){return h.map(e,function(e){var t=$.escapeHtml(e.text);return t&&e.matched&&(t="<strong>"+t+"</strong>"),t}).join("")}(c),this.classes.nowrap)},makeSuggestionLabel:function(e,n){var t,i,s=this.type.fieldNames,o={},a=$.reWordExtractor(),r=[];if(s&&function(e,n){var i=!1;return h.each(e,function(e,t){if(i=t.value==n.value&&t!=n)return!1}),i}(e,n)&&n.data&&(h.each(s,function(e){var t=n.data[e];t&&(o[e]=$.formatToken(t))}),!h.isEmptyObject(o))){for(;(t=a.exec($.formatToken(n.value)))&&(i=t[1]);)h.each(o,function(e,t){if(t==i)return r.push(s[e]),delete o[e],!1});if(r.length)return r.join(", ")}},hide:function(){this.visible=!1,this.selectedIndex=-1,this.$container.hide().empty()},activate:function(e){var t,n,i=this,s=i.classes.selected;return!i.dropdownDisabled&&((n=i.getSuggestionsItems()).removeClass(s),i.selectedIndex=e,-1!==i.selectedIndex&&n.length>i.selectedIndex)?((t=n.eq(i.selectedIndex)).addClass(s),t):null},deactivate:function(e){var t=this;t.dropdownDisabled||(t.selectedIndex=-1,t.getSuggestionsItems().removeClass(t.classes.selected),e&&t.el.val(t.currentValue))},moveUp:function(){var e=this;if(!e.dropdownDisabled)return-1===e.selectedIndex?void(e.suggestions.length&&e.adjustScroll(e.suggestions.length-1)):0===e.selectedIndex?void e.deactivate(!0):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;if(!e.dropdownDisabled)return e.selectedIndex===e.suggestions.length-1?void e.deactivate(!0):void e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var t,n,i,s=this,o=s.activate(e),a=s.$container.scrollTop();o&&o.length&&((t=o.position().top)<0?s.$container.scrollTop(a+t):(n=t+o.outerHeight(),(i=s.$container.innerHeight())<n&&s.$container.scrollTop(a-i+n)),s.el.val(s.suggestions[e].value))}};h.extend(F,{width:"auto",floating:!1}),h.extend(c.prototype,ae),X.on("initialize",ae.createContainer).on("dispose",ae.removeContainer).on("setOptions",ae.setContainerOptions).on("fixPosition",ae.setDropdownPosition).on("fixPosition",ae.setItemsPositions).on("assignSuggestions",ae.suggest);function re(e){var t=O('<span class="suggestions-addon"/>');this.owner=e,this.$el=t,this.type=ue.NONE,this.visible=!1,this.initialPadding=null,t.on("click",R(this,"onClick"))}var ue={NONE:"none",SPINNER:"spinner",CLEAR:"clear"};re.prototype={checkType:function(){var n=this.owner.options.addon,i=!1;p.each(ue,function(e,t){if(i=e==n)return!1}),i||(n=this.owner.isMobile?ue.CLEAR:ue.SPINNER),n!=this.type&&(this.type=n,this.$el.attr("data-addon-type",n),this.toggle(!0))},isEnabled:function(){return!this.owner.isElementDisabled()},toggle:function(e){var t;switch(this.type){case ue.CLEAR:t=!!this.owner.currentValue;break;case ue.SPINNER:t=!!this.owner.currentRequest;break;default:t=!1}this.isEnabled()||(t=!1),t!=this.visible&&((this.visible=t)?this.show(e):this.hide(e))},show:function(e){var t=this,n={opacity:1};e?(this.$el.show().css(n),this.showBackground(!0)):this.$el.stop(!0,!0).delay(50).queue(function(){t.$el.show(),t.showBackground(),t.$el.dequeue()}).animate(n,"fast")},hide:function(e){var t=this,n={opacity:0};e&&this.$el.hide().css(n),this.$el.stop(!0).animate(n,{duration:"fast",complete:function(){t.$el.hide(),t.hideBackground()}})},fixPosition:function(e,t){var n=t.innerHeight;"TEXTAREA"==this.owner.el.prop("tagName")&&(n/=3),this.owner.el.prop&&(this.checkType(),this.$el.css({left:e.left+t.borderLeft+t.innerWidth-n+"px",top:e.top+t.borderTop+"px",height:n,width:n}),this.initialPadding=t.paddingRight,this.width=n,this.visible&&(t.componentsRight+=n))},showBackground:function(e){var t=this.owner.el,n={paddingRight:this.width};this.width>this.initialPadding&&(this.stopBackground(),e?t.css(n):t.animate(n,{duration:"fast",queue:"addon"}).dequeue("addon"))},hideBackground:function(e){var t=this.owner.el,n={paddingRight:this.initialPadding};this.width>this.initialPadding&&(this.stopBackground(!0),e?t.css(n):t.delay(1e3,"addon").animate(n,{duration:"fast",queue:"addon"}).dequeue("addon"))},stopBackground:function(e){this.owner.el.stop("addon",!0,e)},onClick:function(e){this.isEnabled()&&this.type==ue.CLEAR&&this.owner.clear()}};var le=function(){var e=new re(this);this.$wrapper.append(e.$el),this.addon=e},ce=function(e,t){this.addon.fixPosition(e,t)},de=function(){this.addon.checkType()},fe=function(){this.addon.toggle()},pe=function(){this.addon.stopBackground()};L(F,{addon:null}),X.on("initialize",le).on("setOptions",de).on("fixPosition",ce).on("clear",fe).on("valueChange",fe).on("request",fe).on("resetPosition",pe);function he(i,e){var t,n,s=this,o={};s.instance=e,s.fields={},s.specificity=-1,f.isPlainObject(i)&&e.type.dataComponents&&p.each(e.type.dataComponents,function(e,t){var n=e.id;e.forLocations&&i[n]&&(s.fields[n]=i[n],s.specificity=t)}),t=Object.keys(s.fields),(n=p.intersect(t,ge)).length?(p.each(n,function(e,t){o[e]=s.fields[e]}),s.fields=o,s.specificity=s.getFiasSpecificity(n)):s.fields.kladr_id&&(s.fields={kladr_id:s.fields.kladr_id},s.significantKladr=function(e){var t=e.replace(/^(\d{2})(\d*?)(0+)$/g,"$1$2"),n=t.length,i=-1;return n<=2?i=2:2<n&&n<=5?i=5:5<n&&n<=8?i=8:8<n&&n<=11?i=11:11<n&&n<=15?i=15:15<n&&(i=19),k.padEnd(t,i,"0")}(s.fields.kladr_id),s.specificity=s.getKladrSpecificity(s.significantKladr))}var ge=["country_iso_code","region_fias_id","area_fias_id","city_fias_id","city_district_fias_id","settlement_fias_id","street_fias_id"];L(he.prototype,{getLabel:function(){return this.instance.type.composeValue(this.fields,{saveCityDistrict:!0})},getFields:function(){return this.fields},isValid:function(){return!f.isEmptyObject(this.fields)},getKladrSpecificity:function(e){var n=-1,i=e.length;return p.each(this.instance.type.dataComponents,function(e,t){e.kladrFormat&&i===e.kladrFormat.digits&&(n=t)}),n},getFiasSpecificity:function(n){var i=-1;return p.each(this.instance.type.dataComponents,function(e,t){e.fiasType&&-1<n.indexOf(e.fiasType)&&i<t&&(i=t)}),i},containsData:function(n){var i=!0;return this.fields.kladr_id?!!n.kladr_id&&0===n.kladr_id.indexOf(this.significantKladr):(p.each(this.fields,function(e,t){return i=!!n[t]&&n[t].toLowerCase()===e.toLowerCase()}),i)}}),c.ConstraintLocation=he;function me(e,t){this.id=I("c"),this.deletable=!!e.deletable,this.instance=t;var n=p.makeArray(e&&(e.locations||e.restrictions));this.locations=n.map(function(e){return new he(e,t)}),this.locations=this.locations.filter(function(e){return e.isValid()}),this.label=e.label,null==this.label&&t.type.composeValue&&(this.label=this.locations.map(function(e){return e.getLabel()}).join(", ")),this.label&&this.isValid()&&(this.$el=O(document.createElement("li")).append(O(document.createElement("span")).text(this.label)).attr("data-constraint-id",this.id),this.deletable&&this.$el.append(O(document.createElement("span")).addClass(t.classes.removeConstraint)))}L(me.prototype,{isValid:function(){return 0<this.locations.length},getFields:function(){return this.locations.map(function(e){return e.getFields()})}});var ye={createConstraints:function(){var e=this;e.constraints={},e.$constraints=O('<ul class="suggestions-constraints"/>'),e.$wrapper.append(e.$constraints),e.$constraints.on("click","."+e.classes.removeConstraint,R(e.onConstraintRemoveClick,e))},setConstraintsPosition:function(e,t){this.$constraints.css({left:e.left+t.borderLeft+t.paddingLeft+"px",top:e.top+t.borderTop+Math.round((t.innerHeight-this.$constraints.height())/2)+"px"}),t.componentsLeft+=this.$constraints.outerWidth(!0)+t.paddingLeft},onConstraintRemoveClick:function(e){var t=this,n=O(e.target).closest("li"),i=n.attr("data-constraint-id");delete t.constraints[i],t.update(),n.fadeOut("fast",function(){t.removeConstraint(i)})},setupConstraints:function(){var e,n=this,t=n.options.constraints;t?j(t)||"string"==typeof t||"number"==typeof t.nodeType?(e=O(t)).is(n.constraints)||(n.unbindFromParent(),e.is(n.el)||(n.constraints=e,n.bindToParent())):(n._constraintsUpdating=!0,p.each(n.constraints,function(e,t){n.removeConstraint(t)}),p.each(p.makeArray(t),function(e,t){n.addConstraint(e)}),n._constraintsUpdating=!1,n.fixPosition()):n.unbindFromParent()},filteredLocation:function(e){var n=[],i={};if(p.each(this.type.dataComponents,function(){this.forLocations&&n.push(this.id)}),f.isPlainObject(e)&&p.each(e,function(e,t){e&&0<=n.indexOf(t)&&(i[t]=e)}),!f.isEmptyObject(i))return i.kladr_id?{kladr_id:i.kladr_id}:i},addConstraint:function(e){var t=this;!(e=new me(e,t)).isValid()||(t.constraints[e.id]=e).$el&&(t.$constraints.append(e.$el),t._constraintsUpdating||t.fixPosition())},removeConstraint:function(e){delete this.constraints[e],this.$constraints.children('[data-constraint-id="'+e+'"]').remove(),this._constraintsUpdating||this.fixPosition()},constructConstraintsParams:function(){for(var e,t,n=[],i=this.constraints,s={};j(i)&&(e=i.suggestions())&&!(t=l.getDeepValue(e,"selection.data"));)i=e.constraints;return j(i)?(t=new he(t,e).getFields())&&(-1<this.bounds.own.indexOf("city")&&delete t.city_fias_id,s.locations=[t],s.restrict_value=!0):i&&(p.each(i,function(e,t){n=n.concat(e.getFields())}),n.length&&(s.locations=n,s.restrict_value=this.options.restrict_value)),s},getFirstConstraintLabel:function(){var e=f.isPlainObject(this.constraints)&&Object.keys(this.constraints)[0];return e?this.constraints[e].label:""},bindToParent:function(){var e=this;e.constraints.on(["suggestions-select."+e.uniqueId,"suggestions-invalidateselection."+e.uniqueId,"suggestions-clear."+e.uniqueId].join(" "),R(e.onParentSelectionChanged,e)).on("suggestions-dispose."+e.uniqueId,R(e.onParentDispose,e))},unbindFromParent:function(){var e=this.constraints;j(e)&&e.off("."+this.uniqueId)},onParentSelectionChanged:function(e,t,n){"suggestions-select"===e.type&&!n||this.clear()},onParentDispose:function(e){this.unbindFromParent()},getParentInstance:function(){return j(this.constraints)&&this.constraints.suggestions()},shareWithParent:function(e){var t=this.getParentInstance();t&&t.type===this.type&&!function(n,e){var i=e.selection,s=i&&i.data&&e.bounds;return s&&p.each(e.bounds.all,function(e,t){return s=i.data[e]===n.data[e]}),s}(e,t)&&(t.shareWithParent(e),t.setSuggestion(e))},getUnrestrictedData:function(n){var i=[],s={},o=-1;return p.each(this.constraints,function(e,t){p.each(e.locations,function(e,t){e.containsData(n)&&e.specificity>o&&(o=e.specificity)})}),0<=o?(n.region_kladr_id&&n.region_kladr_id===n.city_kladr_id&&i.push.apply(i,this.type.dataComponentsById.city.fields),p.each(this.type.dataComponents.slice(0,o+1),function(e,t){i.push.apply(i,e.fields)}),p.each(n,function(e,t){-1===i.indexOf(t)&&(s[t]=e)})):s=n,s}};L(F,{constraints:null,restrict_value:!1}),L(c.prototype,ye),"GET"!=D.getDefaultType()&&X.on("initialize",ye.createConstraints).on("setOptions",ye.setupConstraints).on("fixPosition",ye.setConstraintsPosition).on("requestParams",ye.constructConstraintsParams).on("dispose",ye.unbindFromParent);var ve={proceedQuery:function(e){e.length>=this.options.minChars?this.updateSuggestions(e):this.hide()},selectCurrentValue:function(t){var n=this,i=P();return n.inputPhase.resolve(),n.fetchPhase.done(function(){var e;n.selection&&!n.visible?i.reject():(e=n.findSuggestionIndex(),n.select(e,t),-1===e?i.reject():i.resolve(e))}).fail(function(){i.reject()}),i},selectFoundSuggestion:function(){this.requestMode.userSelect||this.select(0)},findSuggestionIndex:function(){var t,n=this,i=n.selectedIndex;return-1===i&&(t=n.el.val().trim())&&n.type.matchers.some(function(e){return-1!==(i=e(t,n.suggestions))}),i},select:function(i,s){var o,a=this,e=a.suggestions[i],t=s&&s.continueSelecting,r=a.currentValue;if(!a.triggering.Select){if(!e)return t||a.selection||a.triggerOnSelectNothing(),void a.onSelectComplete(t);o=a.hasSameValues(e),a.enrichSuggestion(e,s).done(function(e,t){var n=L({hasBeenEnriched:t,hasSameValues:o},s);a.selectSuggestion(e,i,r,n)})}},selectSuggestion:function(e,t,n,i){var s=this,o=i.continueSelecting,a=!s.type.isDataComplete||s.type.isDataComplete.call(s,e),r=s.selection;s.triggering.Select||(s.type.alwaysContinueSelecting&&(o=!0),a&&(o=!1),i.hasBeenEnriched&&s.suggestions[t]&&(s.suggestions[t].data=e.data),s.requestMode.updateValue&&(s.checkValueBounds(e),s.currentValue=s.getSuggestionValue(e,i),!s.currentValue||i.noSpace||a||(s.currentValue+=" "),s.el.val(s.currentValue)),s.currentValue?(s.selection=e,s.areSuggestionsSame(e,r)||s.trigger("Select",e,s.currentValue!=n),s.requestMode.userSelect&&s.onSelectComplete(o)):(s.selection=null,s.triggerOnSelectNothing()),s.shareWithParent(e))},onSelectComplete:function(e){e?(this.selectedIndex=-1,this.updateSuggestions(this.currentValue)):this.hide()},triggerOnSelectNothing:function(){this.triggering.SelectNothing||this.trigger("SelectNothing",this.currentValue)},trigger:function(e){var t=this,n=$.slice(arguments,1),i=t.options["on"+e];t.triggering[e]=!0,$.isFunction(i)&&i.apply(t.element,n),t.el.trigger.call(t.el,"suggestions-"+e.toLowerCase(),n),t.triggering[e]=!1}};L(c.prototype,ve),X.on("assignSuggestions",ve.selectFoundSuggestion);var be={setupBounds:function(){this.bounds={from:null,to:null}},setBoundsOptions:function(){var n,e,t=this,i=[],s=h.trim(t.options.bounds).split("-"),o=s[0],a=s[s.length-1],r=[],u=[];t.type.dataComponents&&h.each(t.type.dataComponents,function(){this.forBounds&&i.push(this.id)}),-1===h.inArray(o,i)&&(o=null),-1!==(e=h.inArray(a,i))&&e!==i.length-1||(a=null),(o||a)&&(n=!o,h.each(i,function(e,t){if(t==o&&(n=!0),u.push(t),n&&r.push(t),t==a)return!1})),t.bounds.from=o,t.bounds.to=a,t.bounds.all=u,t.bounds.own=r},constructBoundsParams:function(){var e={};return this.bounds.from&&(e.from_bound={value:this.bounds.from}),this.bounds.to&&(e.to_bound={value:this.bounds.to}),e},checkValueBounds:function(e){var t,n=this;if(n.bounds.own.length&&n.type.composeValue){var i=n.bounds.own.slice(0);1===i.length&&"city_district"===i[0]&&i.push("city_district_fias_id"),t=n.copyDataComponents(e.data,i),e.value=n.type.composeValue(t)}},copyDataComponents:function(n,e){var i={},s=this.type.dataComponentsById;return s&&h.each(e,function(e,t){h.each(s[t].fields,function(e,t){null!=n[t]&&(i[t]=n[t])})}),i},getBoundedKladrId:function(e,t){var n,i=t[t.length-1];return h.each(this.type.dataComponents,function(e,t){if(t.id===i)return n=t.kladrFormat,!1}),e.substr(0,n.digits)+new Array((n.zeros||0)+1).join("0")}};h.extend(F,{bounds:null}),h.extend(c.prototype,be),X.on("initialize",be.setupBounds).on("setOptions",be.setBoundsOptions).on("requestParams",be.constructBoundsParams);var _e={selectByClass:function(e,t){var n="."+e;return t?t.querySelector(n):document.querySelector(n)},addClass:function(e,t){var n=e.className.split(" ");-1===n.indexOf(t)&&n.push(t),e.className=n.join(" ")},setStyle:function(e,t,n){e.style[t]=n},listenTo:function(e,t,n,i){e.addEventListener(t,i,!1),n&&(eventsByNamespace[n]||(eventsByNamespace[n]=[]),eventsByNamespace[n].push({eventName:t,element:e,callback:i}))},stopListeningNamespace:function(e){var t=eventsByNamespace[e];t&&t.forEach(function(e){e.element.removeEventListener(e.eventName,e.callback,!1)})}};i.prototype.show=function(){"FREE"===this.plan&&this.element&&(this.setStyles(),this.setHtml())},i.prototype.setStyles=function(){this.element.style.display="block",this.isMobile||this.element.classList.add(x.promo_desktop)},i.prototype.setHtml=function(){this.element.innerHTML=""},X.on("assignSuggestions",function(){new i(this).show()}),c.defaultOptions=F,c.version="19.8.0",h.Suggestions=c,h.fn.suggestions=function(n,i){return 0===arguments.length?this.first().data("suggestions"):this.each(function(){var e=h(this),t=e.data("suggestions");"string"==typeof n?t&&"function"==typeof t[n]&&t[n](i):(t&&t.dispose&&t.dispose(),t=new c(this,n),e.data("suggestions",t))})}});